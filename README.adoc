= IndieWeb2 Bastion (RSR)
:doctype: book
:toc: left
:toclevels: 3
:icons: font
:source-highlighter: rouge
:sectnums:
:author: Hyperpolymath
:revnumber: 1.0.0-rsr
:revdate: 2025-12-18

[abstract]
.Rhodium Standard Release
The **IndieWeb2 Bastion** is a high-assurance ingress gateway designed for the post-cloud era. It serves as the secure "Gatehouse" for a self-hosted Service Mesh, implementing **TLS 1.3**, **HTTP/3 (QUIC)**, and **Encrypted Client Hello (ECH)** by default. It orchestrates a pod of sidecars including **IPFS**, **Cadre Router**, and **Poly-MCPs** (Model Context Protocols).

---

== 1. Architecture

The Bastion does not run in isolation. It is deployed as a **Podman Pod** (`indieweb2-pod`) sharing a single network namespace on **Port 443**.

[plantuml, architecture, png]
....
@startuml
skinparam monochrome true

actor "User / AI Agent" as User
package "IndieWeb2 Pod (Port 443)" {
  component "Bastion (Gateway)" as Bastion
  component "Cadre Router" as Router
  component "IPFS Node" as IPFS
  component "Poly-MCPs" as MCPs
}

User -> Bastion : HTTPS/3 (QUIC)
Bastion -> Router : HTTP (localhost:3000)
Bastion -> IPFS : HTTP (localhost:8080)
Bastion -> MCPs : SSE (localhost:3001+)
@enduml
....

* **The Gateway (Bastion):** Written in **ReScript/Deno**. Handles auth, TLS termination, and traffic routing.
* **The Brain (Cadre):** Service mesh router for internal logic.
* **The Storage (IPFS):** Decentralized pinning and retrieval.
* **The Coordinator (Robot):** Written in **Ada/SPARK**. Formally verified repository maintenance.

== 2. Prerequisites

The system adheres to the **Rhodium Standard** (RSR) and requires specific tooling:

* **OS:** Linux (Wolfi/Alpine preferred), macOS, or Minix.
* **Container Engine:** Podman (Rootless preferred).
* **Orchestrator:** `just` (Command Runner).
* **Languages:** Deno, ReScript, Nickel, GNAT (Ada).

== 3. Quick Start

We use a **Modular Registry** architecture. All commands are run via `just`.

=== Step 1: Bootstrap & Crypto
Initialize the environment and weave the cryptographic material (Ed448/SHA-512).

[source,bash]
----
just bootstrap
just certs
----

=== Step 2: Build the Stack
Compiles the ReScript Gateway, builds the Ada Coordinator, and assembles the Wolfi containers.

[source,bash]
----
just build
----

=== Step 3: Deploy
Launches the full `indieweb2-pod` on Port 443.

[source,bash]
----
just deploy
----

_System is now online at `https://localhost`._

== 4. Operational Control

=== The Robot Coordinator (Ada/SPARK)
We do not manage the repository manually. We commission the **Robot** to enforce state. The Coordinator is formally verified to prevent unsafe operations.

[source,bash]
----
just ui
----
* **Audit Level:** Select `Forensic` for deep inspection.
* **Repair Mode:** Select `Ruthless` to force compliance (blocked in Forensic mode).

=== Model Context Protocols (MCP)
To connect your AI (Claude/Agent) to this repo:
* **Git Access:** `https://localhost/mcp/git`
* **Filesystem:** `https://localhost/mcp/fs`

== 5. Directory Structure

[source,text]
----
/
├── config/              # Nickel Policy Contracts (*.ncl)
├── container/           # Wolfi Container Definitions
├── internal/            # Sidecar Data (IPFS/Cadre/MCPs)
├── maintenance/         # The Robot & Crypto Loom
├── modules/             # Justfile Modular Registry (*.just)
├── src/
│   ├── coordinator/     # Ada/SPARK TUI Source
│   └── scripts/         # ReScript Gateway Source
└── Justfile             # Master Controller
----

== 6. License & Compliance

* **License:** Dual MIT / AGPLv3 (User Choice).
* **AI Training:** Strictly governed by the **Palimpsest License v0.8**.
* **Standard:** Rhodium (RSR) Certified.
